{"ast":null,"code":"var _jsxFileName = \"/home/rolikasi/outreachy/digital-public-goods-map/components/mapComponent.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useRef } from \"react\";\nimport ReactMapboxGl, { ZoomControl, MapContext } from \"react-mapbox-gl\";\nimport confirmedPattern from \"../public/confirmed.svg\";\nimport exploratoryPattern from \"../public/exploratory.svg\";\nimport hardwarePattern from \"../public/hardware.svg\";\nimport { Scrollama, Step } from \"react-scrollama\";\nimport { InView } from \"react-intersection-observer\";\nimport SearchBox from \"./searchBox\";\nimport InfoComponent from \"./infoComponent\";\nimport UseWindowDimensions from \"./UseWindowDimensions\";\nimport dpgaLogo from \"../public/logo.svg\";\nconst layerStyles = {\n  \"Pathfinders Exploratory\": {\n    backgroundImage: `url(${exploratoryPattern})`\n  },\n  \"Pathfinders Confirmed\": {\n    backgroundImage: `url(${confirmedPattern})`\n  },\n  \"DPGs developed\": {\n    backgroundColor: \"#FF952A\"\n  },\n  \"DPGs deployed\": {\n    backgroundColor: \"#3333AB\"\n  }\n};\nconst legends = [\"where DPG was developed\", \"where DPG was deployed\"];\nconst colors = [\"#FF952A\", \"#d4d4ec\"];\nconst zoomDefault = 2;\nconst SDGS = [\"No Poverty\", \"Zero Hunger\", \"Good Health and Well-being\", \"Quality Education\", \"Gender Equality\", \"Clean Water and Sanitation\", \"Affordable and Clean Energy\", \"Decent Work and Economic Growth\", \"Industry, Innovation and Infrastructure\", \"Reduced Inequality\", \"Sustainable Cities and Communities\", \"Responsible Consumption and Production\", \"Climate Action\", \"Life Below Water\", \"Life on Land\", \"Peace and Justice Strong Institutions\", \"Partnerships to achieve the Goal\"];\n\nconst sdgsDefault = () => {\n  let obj = {};\n\n  for (let i = 0; i < SDGS.length; i++) {\n    obj[i + 1] = {\n      dpgs: 0,\n      ann: SDGS[i]\n    };\n  }\n\n  return obj;\n}; // console.log(process.env.MAPBOX_ACCESS_TOKEN)\n\n\nconst Map = ReactMapboxGl({\n  accessToken: process.env.NEXT_PUBLIC_MAPBOX_TOKEN,\n  maxZoom: 9,\n  minZoom: 0,\n  logoPosition: \"bottom-right\",\n  pitchWithRotate: false\n});\nexport default function mapComponent(props) {\n  const {\n    0: mapInstance,\n    1: setMapInstance\n  } = useState();\n  const ref = useRef();\n  const mainRef = useRef();\n  const searchRef = useRef();\n  const {\n    width\n  } = UseWindowDimensions();\n  const {\n    0: zoom,\n    1: setZoom\n  } = useState(zoomDefault);\n  const {\n    0: lonLat,\n    1: setLonLat\n  } = useState([props.lon, props.lat]);\n  const {\n    0: selectedGood,\n    1: setSelectedGood\n  } = useState({});\n  const {\n    0: selectedCountry,\n    1: setSelectedCountry\n  } = useState({});\n  const {\n    0: prevGood,\n    1: setPrevGood\n  } = useState({});\n  const {\n    0: visibleLayer,\n    1: setVisibleLayer\n  } = useState({\n    \"Pathfinders Exploratory\": false,\n    \"Pathfinders Confirmed\": false,\n    \"DPGs deployed\": false,\n    \"DPGs developed\": false\n  });\n  const {\n    0: mapInteractive,\n    1: setMapInteractive\n  } = useState(false); // scrollama states\n\n  const {\n    0: currentStepIndex,\n    1: setCurrentStepIndex\n  } = useState(0);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true); // This callback fires when a Step hits the offset threshold. It receives the\n  // data prop of the step, which in this demo stores the index of the step.\n\n  const onStepEnter = ({\n    data\n  }) => {\n    setCurrentStepIndex(data); // Check and set selectedGood from gsheet\n\n    if (props.story[data].showDPG) {\n      setSelectedGood(prevState => {\n        setPrevGood(prevState);\n        return props.digitalGoods.filter(el => el.name.toLowerCase().indexOf(props.story[data].showDPG.toLowerCase()) !== -1)[0]; // filter and grab 1st result\n      });\n    } else {\n      // clear state if there is no dpg in gsheet\n      setSelectedGood(prevState => {\n        setPrevGood(prevState);\n        return {};\n      });\n    } // Check and set visible layer from gsheet\n\n\n    if (props.story[data].showFilter) {\n      let newVisibleLayer = {};\n      Object.keys(visibleLayer).forEach(v => newVisibleLayer[v] = props.story[data].showFilter.includes(v));\n      setVisibleLayer(newVisibleLayer);\n    } else {\n      setVisibleLayer({\n        \"Pathfinders Exploratory\": false,\n        \"Pathfinders Confirmed\": false,\n        \"DPGs deployed\": false,\n        \"DPGs developed\": false\n      });\n    }\n  };\n\n  const handleSelectCountry = code => {\n    setSelectedGood(prevState => {\n      setPrevGood(prevState);\n      return {};\n    });\n    const deployments = props.digitalGoods.filter(good => Object.keys(good.locations.deploymentCountries).includes(code));\n    const developments = props.digitalGoods.filter(good => Object.keys(good.locations.developmentCountries).includes(code));\n    const countryName = props.countries[code].name; // set country name in searchbox\n\n    searchRef.current.changeInput(countryName); // count sdgs for each country\n\n    const sdgsDeploymentsInfo = Object.entries(deployments.reduce((accum, curr) => [...accum, ...curr.SDGs.map(sdg => {\n      return sdg.SDGNumber;\n    })], []).reduce((acc, curr) => {\n      return acc[curr] ? ++acc[curr][\"dpgs\"] : acc[curr][\"dpgs\"] = 1, acc;\n    }, //initial value helps us create all elements of object\n    _objectSpread({}, sdgsDefault()))); // count types of dpgs for each country\n\n    const typeDeploymentsInfo = Object.entries(deployments.reduce((accum, curr) => [...accum, ...curr.type.map(type => type)], []).reduce((acc, curr) => {\n      return acc[curr] ? ++acc[curr] : acc[curr] = 1, acc;\n    }, //initial value helps us create all elements of object\n    {\n      content: 0,\n      data: 0,\n      software: 0,\n      standard: 0,\n      \"AI model\": 0\n    }));\n    setZoom(6);\n    setLonLat([props.countries[code].lon, props.countries[code].lat]);\n    setSelectedCountry({\n      deployments: deployments,\n      developments: developments,\n      pathfinder: props.countries[code].pathfinder,\n      name: countryName,\n      sdgsDeployments: sdgsDeploymentsInfo,\n      typeDeployments: typeDeploymentsInfo\n    });\n    ref.current.clearStatesFromParent();\n    searchRef.current.changeInput(countryName);\n    width < 1008 && ref.current.scrollFromMap();\n  };\n\n  const handleSelectGoodPopup = goodName => {\n    setSelectedGood(prevState => {\n      setPrevGood(prevState);\n      return props.digitalGoods.filter(el => el.name.toLowerCase().indexOf(goodName.toLowerCase()) !== -1)[0]; // filter and grab 1st result\n    });\n    setSelectedCountry({});\n    searchRef.current.changeInput(goodName);\n  };\n\n  const handleChangeSearchbox = good => {\n    setSelectedGood(prevState => {\n      setPrevGood(prevState);\n      return good;\n    });\n    setSelectedCountry({});\n    ref.current.clearStatesFromParent();\n  };\n\n  const handleLayerToggle = layer => {\n    setVisibleLayer(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n      [layer]: !prevState[layer]\n    }));\n  };\n\n  const handleClearSearchbox = () => {\n    setSelectedGood(prevState => {\n      setPrevGood(prevState);\n      return {};\n    });\n    setSelectedCountry({});\n    ref.current.clearStatesFromParent();\n  };\n\n  const handleScrollToBottom = () => {\n    width < 1008 ? ref.current.scrollFromParent() : mainRef.current.scrollIntoView(false, {\n      behavior: \"smooth\",\n      block: \"end\",\n      inline: \"nearest\"\n    });\n  };\n\n  return __jsx(\"div\", {\n    ref: mainRef,\n    className: \"visContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: loading ? \"whiteBack\" : \"inactive\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }\n  }, __jsx(\"img\", {\n    className: \"loader\",\n    src: dpgaLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 9\n    }\n  })), __jsx(\"div\", {\n    className: \"map\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: mapInteractive ? \"mapContainer right\" : \"mapContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 9\n    }\n  }, mapInteractive && width < 1008 && __jsx(SearchBox, {\n    ref: searchRef,\n    goods: props.digitalGoods,\n    countries: props.countries,\n    onSelectCountry: handleSelectCountry,\n    selectedGood: selectedGood.name,\n    selectedCountry: selectedCountry.name,\n    onSelectGood: handleChangeSearchbox,\n    clearSelectedGood: handleClearSearchbox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }\n  }), props.story.length && props.story[currentStepIndex].image != \"false\" && !mapInteractive && __jsx(\"img\", {\n    className: \"stepImage\",\n    src: props.story[currentStepIndex].imageUrl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 13\n    }\n  }), __jsx(Map, {\n    style: \"mapbox://styles/rolikasi/ckn67a95j022m17mcqog82g05\",\n    center: mapInteractive ? lonLat : [parseFloat(props.story[currentStepIndex].longitude), parseFloat(props.story[currentStepIndex].latitude)],\n    zoom: mapInteractive ? [zoom] : [parseFloat(props.story[currentStepIndex].zoom)],\n    pitch: visibleLayer[\"DPGs developed\"] || visibleLayer[\"DPGs deployed\"] ? 60 : 0 // pitch in degrees\n    ,\n    containerStyle: {\n      width: \"100%\",\n      height: \"100%\",\n      position: \"absolute\",\n      top: 0,\n      right: 0\n    },\n    className: mapInteractive ? \"enabled\" : \"disabled\",\n    movingMethod: \"flyTo\",\n    onDragEnd: (map, eventData) => {\n      if (mapInteractive) {\n        setLonLat([map.getCenter().lng, map.getCenter().lat]);\n      }\n    },\n    onZoomEnd: (map, eventData) => {\n      if (mapInteractive) {\n        setZoom(map.getZoom());\n      }\n    },\n    onStyleLoad: map => {\n      var layers = map.getStyle().layers; // Find the index of the first symbol layer in the map style\n\n      var firstSymbolId;\n\n      for (let i = 0; i < layers.length; i++) {\n        if (layers[i].type === \"symbol\") {\n          firstSymbolId = layers[i].id;\n          break;\n        }\n      }\n\n      let hardwareImg = new Image(20, 20);\n\n      hardwareImg.onload = () => map.addImage(\"hardware-pattern\", hardwareImg);\n\n      hardwareImg.src = hardwarePattern; //add layer for each good with map\n\n      props.digitalGoods.map(good => {\n        // check if layer is already created\n        if (map.getLayer(good.name + \"-develop\")) {\n          console.log(good.name + \" is layer already created\");\n          return;\n        } else {\n          map.addLayer({\n            id: good.name + \"-develop\",\n            source: {\n              type: \"vector\",\n              url: \"mapbox://rolikasi.2kn4jvyh\"\n            },\n            \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n            type: \"fill\",\n            paint: {\n              // 'fill-color': '#db3d44', // this is the color you want your tileset to have (red)\n              \"fill-pattern\": \"hardware-pattern\" //this helps us distinguish individual countries a bit better by giving them an outline\n\n            }\n          }, firstSymbolId);\n          map.setLayoutProperty(good.name + \"-develop\", \"visibility\", \"none\");\n          map.setFilter(good.name + \"-develop\", [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(good.locations.developmentCountries))); // This line lets us filter by country codes.\n\n          map.addLayer({\n            id: good.name + \"-deploy\",\n            source: {\n              type: \"vector\",\n              url: \"mapbox://rolikasi.2kn4jvyh\"\n            },\n            \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n            type: \"fill\",\n            paint: {\n              // 'fill-color': '#db3d44', // this is the color you want your tileset to have (red)\n              \"fill-color\": \"#3333AB\",\n              //this helps us distinguish individual countries a bit better by giving them an outline\n              \"fill-opacity\": 0.2\n            }\n          }, firstSymbolId);\n          map.setLayoutProperty(good.name + \"-deploy\", \"visibility\", \"none\");\n          map.setFilter(good.name + \"-deploy\", [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(good.locations.deploymentCountries))); // This line lets us filter by country codes.\n        }\n      }); // Declare the image\n\n      if (map.getLayer(\"Pathfinders Exploratory\")) {\n        console.log(\"Pathfinders Exploratory is layer already created\");\n        return;\n      } else {\n        let exploratoryImg = new Image(20, 20);\n\n        exploratoryImg.onload = () => map.addImage(\"exploratory-pattern\", exploratoryImg);\n\n        exploratoryImg.src = exploratoryPattern; // Use it\n\n        map.addLayer({\n          // adding a layer containing the tileset with country boundaries\n          id: \"Pathfinders Exploratory\",\n          //this is the name of our layer, which we will need later\n          source: {\n            type: \"vector\",\n            url: \"mapbox://rolikasi.2kn4jvyh\"\n          },\n          \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n          type: \"fill\",\n          paint: {\n            \"fill-pattern\": \"exploratory-pattern\",\n            \"fill-opacity\": 0.5\n          },\n          layout: {\n            visibility: \"none\"\n          }\n        }, firstSymbolId);\n        map.setFilter(\"Pathfinders Exploratory\", [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(props.pathfinderExploratory))); // This line lets us filter by country codes.\n      }\n\n      if (map.getLayer(\"Pathfinders Confirmed\")) {\n        console.log(\"Pathfinders Confirmed layer is already created\");\n        return;\n      } else {\n        // Declare the image\n        let confirmedImg = new Image(20, 20);\n\n        confirmedImg.onload = () => map.addImage(\"confirmed-pattern\", confirmedImg);\n\n        confirmedImg.src = confirmedPattern; // Use it\n\n        map.addLayer({\n          // adding a layer containing the tileset with country boundaries\n          id: \"Pathfinders Confirmed\",\n          //this is the name of our layer, which we will need later\n          source: {\n            type: \"vector\",\n            url: \"mapbox://rolikasi.2kn4jvyh\"\n          },\n          \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n          type: \"fill\",\n          paint: {\n            \"fill-pattern\": \"confirmed-pattern\",\n            \"fill-opacity\": 0.5\n          },\n          layout: {\n            visibility: \"none\"\n          }\n        }, firstSymbolId);\n        map.setFilter(\"Pathfinders Confirmed\", [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(props.pathfinderConfirmed))); // This line lets us filter by country codes.\n      }\n\n      if (map.getLayer(\"countries\")) {\n        console.log(\"countries layer is already created\");\n        return;\n      } else {\n        map.addLayer({\n          // adding a layer containing the tileset with country boundaries\n          id: \"countries\",\n          //this is the name of our layer, which we will need later\n          source: {\n            type: \"vector\",\n            url: \"mapbox://rolikasi.2kn4jvyh\"\n          },\n          \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n          type: \"fill\",\n          paint: {\n            \"fill-color\": \"white\",\n            //this helps us distinguish individual countries a bit better by giving them an outline\n            \"fill-opacity\": 0\n          }\n        }, firstSymbolId);\n        map.setFilter(\"countries\", [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(props.countries))); // This line lets us filter by country codes.\n\n        console.log('map.getLayer(\"countries\")', map.getLayer(\"countries\")); // Add 3d layer with extrudes\n\n        map.addSource(\"DPGs developed-polygons-source\", {\n          type: \"geojson\",\n          data: props.devPolygons\n        });\n        map.addSource(\"DPGs deployed-polygons-source\", {\n          type: \"geojson\",\n          data: props.depPolygons\n        });\n        map.addLayer({\n          id: \"DPGs developed\",\n          source: \"DPGs developed-polygons-source\",\n          type: \"fill-extrusion\",\n          paint: {\n            \"fill-extrusion-color\": \"#FF952A\",\n            \"fill-extrusion-height\": [\"get\", \"height\"],\n            \"fill-extrusion-base\": [\"get\", \"base\"]\n          },\n          layout: {\n            visibility: \"none\"\n          }\n        });\n        map.addLayer({\n          id: \"DPGs deployed\",\n          source: \"DPGs deployed-polygons-source\",\n          type: \"fill-extrusion\",\n          paint: {\n            \"fill-extrusion-color\": \"#3333AB\",\n            \"fill-extrusion-height\": [\"get\", \"height\"],\n            \"fill-extrusion-base\": [\"get\", \"base\"]\n          },\n          layout: {\n            visibility: \"none\"\n          }\n        });\n        [\"DPGs deployed\", \"DPGs developed\"].map((layer, i) => map.addLayer({\n          id: `${layer}-text`,\n          source: `${layer}-polygons-source`,\n          type: \"symbol\",\n          paint: {\n            \"text-color\": [\"#3333AB\", \"#FF952A\"][i],\n            \"text-halo-color\": \"#fff\",\n            \"text-halo-width\": 1\n          },\n          layout: {\n            \"text-field\": [\"get\", \"text-field\"],\n            \"text-size\": [\"interpolate\", [\"linear\"], [\"zoom\"], 4.5, 0, 5, 16],\n            \"text-offset\": [\"interpolate\", [\"linear\"], [\"zoom\"], 4.5, [\"literal\", [0, 0.5]], 9, [\"literal\", [0, 3]]],\n            visibility: \"none\"\n          }\n        }));\n        setLoading(false); // set map so we can resize() it in future from anywhere\n\n        setMapInstance(map); // set country info when clicked on country with any data\n\n        map.on(\"click\", \"countries\", function (mapElement) {\n          handleSelectCountry(mapElement.features[0].properties.ADM0_A3_IS);\n        });\n        map.on(\"mouseenter\", \"countries\", () => {\n          map.getCanvas().style.cursor = \"pointer\";\n        });\n        map.on(\"mouseleave\", \"countries\", () => {\n          map.getCanvas().style.cursor = \"\";\n        });\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 11\n    }\n  }, __jsx(ZoomControl, {\n    position: \"bottom-right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 541,\n      columnNumber: 13\n    }\n  }), __jsx(MapContext.Consumer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 542,\n      columnNumber: 13\n    }\n  }, map => {\n    Object.keys(visibleLayer).map(layer => {\n      console.log(\"toggle \", layer, \" visibility\");\n      map.getLayer(layer) ? map.setLayoutProperty(layer, \"visibility\", visibleLayer[layer] ? \"visible\" : \"none\") : null; // toggle text layer for 3d visualizations\n\n      if ([\"DPGs developed\", \"DPGs deployed\"].includes(layer)) {\n        map.getLayer(layer + \"-text\") ? map.setLayoutProperty(layer + \"-text\", \"visibility\", visibleLayer[layer] ? \"visible\" : \"none\") : null;\n      }\n    });\n\n    if (prevGood.name) {\n      console.log(\"toggle prevgood visibility\");\n      map.setLayoutProperty(prevGood.name + \"-develop\", \"visibility\", \"none\");\n      map.setLayoutProperty(prevGood.name + \"-deploy\", \"visibility\", \"none\");\n    }\n\n    if (selectedGood.name) {\n      console.log(\"toggle selected good visibility\");\n      map.setLayoutProperty(selectedGood.name + \"-develop\", \"visibility\", \"visible\");\n      map.setLayoutProperty(selectedGood.name + \"-deploy\", \"visibility\", \"visible\");\n    }\n  }))), __jsx(InView, {\n    as: \"div\",\n    onChange: inView => {\n      setMapInteractive(!inView);\n      if (mapInstance) mapInstance.resize();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 588,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"scroller\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 11\n    }\n  }, __jsx(Scrollama, {\n    onStepEnter: onStepEnter,\n    offset: \"0.7\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 596,\n      columnNumber: 13\n    }\n  }, props.story.map((_, stepIndex) => __jsx(Step, {\n    data: stepIndex,\n    key: stepIndex,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 598,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: `scrolly-p ${stepIndex == 0 ? \"first\" : \"\"} ${stepIndex == props.story.length - 1 ? \"last\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 19\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 604,\n      columnNumber: 21\n    }\n  }, _.text), stepIndex == 0 && __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 606,\n      columnNumber: 23\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 607,\n      columnNumber: 25\n    }\n  }, \"Scroll down to see the story or skip it and\", \" \", __jsx(\"span\", {\n    className: \"button\",\n    onClick: handleScrollToBottom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 609,\n      columnNumber: 27\n    }\n  }, \"explore the map\")), __jsx(\"div\", {\n    className: \"scrollArrows\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 614,\n      columnNumber: 25\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 615,\n      columnNumber: 27\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 616,\n      columnNumber: 27\n    }\n  }))))))))), __jsx(\"div\", {\n    className: selectedGood.name || Object.values(visibleLayer).some(item => item) && !mapInteractive && props.story[currentStepIndex].image == \"false\" ? \"map-overlay active\" : \"map-overlay\",\n    id: \"legend\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 627,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"legendContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 635,\n      columnNumber: 11\n    }\n  }, selectedGood.name && legends.map((legend, index) => __jsx(\"div\", {\n    key: legend + index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 637,\n      columnNumber: 15\n    }\n  }, __jsx(\"span\", {\n    className: \"legend-key\",\n    style: index == 0 ? {\n      backgroundImage: `url(${hardwarePattern})`\n    } : {\n      backgroundColor: colors[index]\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 638,\n      columnNumber: 17\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 646,\n      columnNumber: 17\n    }\n  }, legend))), !mapInteractive && Object.entries(visibleLayer).map((layer, index) => {\n    return layer[1] && __jsx(\"div\", {\n      key: layer[0] + index,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 651,\n        columnNumber: 15\n      }\n    }, __jsx(\"span\", {\n      className: \"legend-key rectangle\",\n      style: layerStyles[layer[0]],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 652,\n        columnNumber: 17\n      }\n    }), __jsx(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 657,\n        columnNumber: 17\n      }\n    }, layer[0]));\n  })))), mapInteractive && width >= 1008 && __jsx(InfoComponent, {\n    selectedGood: selectedGood,\n    selectedCountry: selectedCountry,\n    onSelectGood: handleSelectGoodPopup,\n    onSelectCountry: handleSelectCountry,\n    onLayerToggle: handleLayerToggle,\n    visibleLayer: visibleLayer,\n    ref: ref,\n    SearchBox: __jsx(SearchBox, {\n      ref: searchRef,\n      goods: props.digitalGoods,\n      countries: props.countries,\n      onSelectCountry: handleSelectCountry,\n      selectedGood: selectedGood.name,\n      selectedCountry: selectedCountry.name,\n      onSelectGood: handleChangeSearchbox,\n      clearSelectedGood: handleClearSearchbox,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 673,\n        columnNumber: 13\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 664,\n      columnNumber: 9\n    }\n  }), width < 1008 && __jsx(InfoComponent, {\n    selectedGood: selectedGood,\n    selectedCountry: selectedCountry,\n    onSelectGood: handleSelectGoodPopup,\n    onSelectCountry: handleSelectCountry,\n    visibleLayer: visibleLayer,\n    onLayerToggle: handleLayerToggle,\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 687,\n      columnNumber: 9\n    }\n  }));\n}","map":{"version":3,"sources":["/home/rolikasi/outreachy/digital-public-goods-map/components/mapComponent.js"],"names":["React","useState","useRef","ReactMapboxGl","ZoomControl","MapContext","confirmedPattern","exploratoryPattern","hardwarePattern","Scrollama","Step","InView","SearchBox","InfoComponent","UseWindowDimensions","dpgaLogo","layerStyles","backgroundImage","backgroundColor","legends","colors","zoomDefault","SDGS","sdgsDefault","obj","i","length","dpgs","ann","Map","accessToken","process","env","NEXT_PUBLIC_MAPBOX_TOKEN","maxZoom","minZoom","logoPosition","pitchWithRotate","mapComponent","props","mapInstance","setMapInstance","ref","mainRef","searchRef","width","zoom","setZoom","lonLat","setLonLat","lon","lat","selectedGood","setSelectedGood","selectedCountry","setSelectedCountry","prevGood","setPrevGood","visibleLayer","setVisibleLayer","mapInteractive","setMapInteractive","currentStepIndex","setCurrentStepIndex","loading","setLoading","onStepEnter","data","story","showDPG","prevState","digitalGoods","filter","el","name","toLowerCase","indexOf","showFilter","newVisibleLayer","Object","keys","forEach","v","includes","handleSelectCountry","code","deployments","good","locations","deploymentCountries","developments","developmentCountries","countryName","countries","current","changeInput","sdgsDeploymentsInfo","entries","reduce","accum","curr","SDGs","map","sdg","SDGNumber","acc","typeDeploymentsInfo","type","content","software","standard","pathfinder","sdgsDeployments","typeDeployments","clearStatesFromParent","scrollFromMap","handleSelectGoodPopup","goodName","handleChangeSearchbox","handleLayerToggle","layer","handleClearSearchbox","handleScrollToBottom","scrollFromParent","scrollIntoView","behavior","block","inline","image","imageUrl","parseFloat","longitude","latitude","height","position","top","right","eventData","getCenter","lng","getZoom","layers","getStyle","firstSymbolId","id","hardwareImg","Image","onload","addImage","src","getLayer","console","log","addLayer","source","url","paint","setLayoutProperty","setFilter","concat","exploratoryImg","layout","visibility","pathfinderExploratory","confirmedImg","pathfinderConfirmed","addSource","devPolygons","depPolygons","on","mapElement","features","properties","ADM0_A3_IS","getCanvas","style","cursor","inView","resize","_","stepIndex","text","values","some","item","legend","index"],"mappings":"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","sourcesContent":["import React, {useState, useRef} from \"react\";\nimport ReactMapboxGl, {ZoomControl, MapContext} from \"react-mapbox-gl\";\nimport confirmedPattern from \"../public/confirmed.svg\";\nimport exploratoryPattern from \"../public/exploratory.svg\";\nimport hardwarePattern from \"../public/hardware.svg\";\nimport {Scrollama, Step} from \"react-scrollama\";\nimport {InView} from \"react-intersection-observer\";\nimport SearchBox from \"./searchBox\";\nimport InfoComponent from \"./infoComponent\";\nimport UseWindowDimensions from \"./UseWindowDimensions\";\nimport dpgaLogo from \"../public/logo.svg\";\n\nconst layerStyles = {\n  \"Pathfinders Exploratory\": {\n    backgroundImage: `url(${exploratoryPattern})`,\n  },\n  \"Pathfinders Confirmed\": {\n    backgroundImage: `url(${confirmedPattern})`,\n  },\n  \"DPGs developed\": {\n    backgroundColor: \"#FF952A\",\n  },\n  \"DPGs deployed\": {\n    backgroundColor: \"#3333AB\",\n  },\n};\nconst legends = [\"where DPG was developed\", \"where DPG was deployed\"];\nconst colors = [\"#FF952A\", \"#d4d4ec\"];\nconst zoomDefault = 2;\nconst SDGS = [\n  \"No Poverty\",\n  \"Zero Hunger\",\n  \"Good Health and Well-being\",\n  \"Quality Education\",\n  \"Gender Equality\",\n  \"Clean Water and Sanitation\",\n  \"Affordable and Clean Energy\",\n  \"Decent Work and Economic Growth\",\n  \"Industry, Innovation and Infrastructure\",\n  \"Reduced Inequality\",\n  \"Sustainable Cities and Communities\",\n  \"Responsible Consumption and Production\",\n  \"Climate Action\",\n  \"Life Below Water\",\n  \"Life on Land\",\n  \"Peace and Justice Strong Institutions\",\n  \"Partnerships to achieve the Goal\",\n];\nconst sdgsDefault = () => {\n  let obj = {};\n  for (let i = 0; i < SDGS.length; i++) {\n    obj[i + 1] = {dpgs: 0, ann: SDGS[i]};\n  }\n  return obj;\n};\n// console.log(process.env.MAPBOX_ACCESS_TOKEN)\nconst Map = ReactMapboxGl({\n  accessToken: process.env.NEXT_PUBLIC_MAPBOX_TOKEN,\n  maxZoom: 9,\n  minZoom: 0,\n  logoPosition: \"bottom-right\",\n  pitchWithRotate: false,\n});\n\nexport default function mapComponent(props) {\n  const [mapInstance, setMapInstance] = useState();\n  const ref = useRef();\n  const mainRef = useRef();\n  const searchRef = useRef();\n  const {width} = UseWindowDimensions();\n  const [zoom, setZoom] = useState(zoomDefault);\n  const [lonLat, setLonLat] = useState([props.lon, props.lat]);\n  const [selectedGood, setSelectedGood] = useState({});\n  const [selectedCountry, setSelectedCountry] = useState({});\n  const [prevGood, setPrevGood] = useState({});\n  const [visibleLayer, setVisibleLayer] = useState({\n    \"Pathfinders Exploratory\": false,\n    \"Pathfinders Confirmed\": false,\n    \"DPGs deployed\": false,\n    \"DPGs developed\": false,\n  });\n  const [mapInteractive, setMapInteractive] = useState(false);\n\n  // scrollama states\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [loading, setLoading] = useState(true);\n\n  // This callback fires when a Step hits the offset threshold. It receives the\n  // data prop of the step, which in this demo stores the index of the step.\n  const onStepEnter = ({data}) => {\n    setCurrentStepIndex(data);\n    // Check and set selectedGood from gsheet\n    if (props.story[data].showDPG) {\n      setSelectedGood((prevState) => {\n        setPrevGood(prevState);\n        return props.digitalGoods.filter(\n          (el) =>\n            el.name.toLowerCase().indexOf(props.story[data].showDPG.toLowerCase()) !== -1\n        )[0]; // filter and grab 1st result\n      });\n    } else {\n      // clear state if there is no dpg in gsheet\n      setSelectedGood((prevState) => {\n        setPrevGood(prevState);\n        return {};\n      });\n    }\n    // Check and set visible layer from gsheet\n    if (props.story[data].showFilter) {\n      let newVisibleLayer = {};\n      Object.keys(visibleLayer).forEach(\n        (v) => (newVisibleLayer[v] = props.story[data].showFilter.includes(v))\n      );\n      setVisibleLayer(newVisibleLayer);\n    } else {\n      setVisibleLayer({\n        \"Pathfinders Exploratory\": false,\n        \"Pathfinders Confirmed\": false,\n        \"DPGs deployed\": false,\n        \"DPGs developed\": false,\n      });\n    }\n  };\n\n  const handleSelectCountry = (code) => {\n    setSelectedGood((prevState) => {\n      setPrevGood(prevState);\n      return {};\n    });\n\n    const deployments = props.digitalGoods.filter((good) =>\n      Object.keys(good.locations.deploymentCountries).includes(code)\n    );\n    const developments = props.digitalGoods.filter((good) =>\n      Object.keys(good.locations.developmentCountries).includes(code)\n    );\n    const countryName = props.countries[code].name;\n    // set country name in searchbox\n    searchRef.current.changeInput(countryName);\n    // count sdgs for each country\n    const sdgsDeploymentsInfo = Object.entries(\n      deployments\n        .reduce(\n          (accum, curr) => [\n            ...accum,\n            ...curr.SDGs.map((sdg) => {\n              return sdg.SDGNumber;\n            }),\n          ],\n          []\n        )\n        .reduce(\n          (acc, curr) => {\n            return acc[curr] ? ++acc[curr][\"dpgs\"] : (acc[curr][\"dpgs\"] = 1), acc;\n          },\n          //initial value helps us create all elements of object\n          {...sdgsDefault()}\n        )\n    );\n    // count types of dpgs for each country\n    const typeDeploymentsInfo = Object.entries(\n      deployments\n        .reduce((accum, curr) => [...accum, ...curr.type.map((type) => type)], [])\n        .reduce(\n          (acc, curr) => {\n            return acc[curr] ? ++acc[curr] : (acc[curr] = 1), acc;\n          },\n          //initial value helps us create all elements of object\n          {content: 0, data: 0, software: 0, standard: 0, \"AI model\": 0}\n        )\n    );\n\n    setZoom(6);\n    setLonLat([props.countries[code].lon, props.countries[code].lat]);\n    setSelectedCountry({\n      deployments: deployments,\n      developments: developments,\n      pathfinder: props.countries[code].pathfinder,\n      name: countryName,\n      sdgsDeployments: sdgsDeploymentsInfo,\n      typeDeployments: typeDeploymentsInfo,\n    });\n    ref.current.clearStatesFromParent();\n    searchRef.current.changeInput(countryName);\n    width < 1008 && ref.current.scrollFromMap();\n  };\n  const handleSelectGoodPopup = (goodName) => {\n    setSelectedGood((prevState) => {\n      setPrevGood(prevState);\n      return props.digitalGoods.filter(\n        (el) => el.name.toLowerCase().indexOf(goodName.toLowerCase()) !== -1\n      )[0]; // filter and grab 1st result\n    });\n    setSelectedCountry({});\n    searchRef.current.changeInput(goodName);\n  };\n\n  const handleChangeSearchbox = (good) => {\n    setSelectedGood((prevState) => {\n      setPrevGood(prevState);\n      return good;\n    });\n    setSelectedCountry({});\n    ref.current.clearStatesFromParent();\n  };\n  const handleLayerToggle = (layer) => {\n    setVisibleLayer((prevState) => ({...prevState, [layer]: !prevState[layer]}));\n  };\n  const handleClearSearchbox = () => {\n    setSelectedGood((prevState) => {\n      setPrevGood(prevState);\n      return {};\n    });\n    setSelectedCountry({});\n    ref.current.clearStatesFromParent();\n  };\n  const handleScrollToBottom = () => {\n    width < 1008\n      ? ref.current.scrollFromParent()\n      : mainRef.current.scrollIntoView(false, {\n          behavior: \"smooth\",\n          block: \"end\",\n          inline: \"nearest\",\n        });\n  };\n\n  return (\n    <div ref={mainRef} className='visContainer'>\n      <div className={loading ? \"whiteBack\" : \"inactive\"}>\n        <img className={\"loader\"} src={dpgaLogo}></img>\n      </div>\n      <div className=\"map\">\n        <div className={mapInteractive ? \"mapContainer right\" : \"mapContainer\"}>\n          {mapInteractive && width < 1008 && (\n            <SearchBox\n              ref={searchRef}\n              goods={props.digitalGoods}\n              countries={props.countries}\n              onSelectCountry={handleSelectCountry}\n              selectedGood={selectedGood.name}\n              selectedCountry={selectedCountry.name}\n              onSelectGood={handleChangeSearchbox}\n              clearSelectedGood={handleClearSearchbox}\n            />\n          )}\n          {props.story.length && props.story[currentStepIndex].image != \"false\" && !mapInteractive && (\n            <img className=\"stepImage\" src={props.story[currentStepIndex].imageUrl} />\n          )}\n          <Map\n            style=\"mapbox://styles/rolikasi/ckn67a95j022m17mcqog82g05\"\n            center={\n              mapInteractive\n                ? lonLat\n                : [\n                    parseFloat(props.story[currentStepIndex].longitude),\n                    parseFloat(props.story[currentStepIndex].latitude),\n                  ]\n            }\n            zoom={\n              mapInteractive ? [zoom] : [parseFloat(props.story[currentStepIndex].zoom)]\n            }\n            pitch={\n              visibleLayer[\"DPGs developed\"] || visibleLayer[\"DPGs deployed\"] ? 60 : 0\n            } // pitch in degrees\n            containerStyle={{\n              width: \"100%\",\n              height: \"100%\",\n              position: \"absolute\",\n              top: 0,\n              right: 0,\n            }}\n            className={mapInteractive ? \"enabled\" : \"disabled\"}\n            movingMethod=\"flyTo\"\n            onDragEnd={(map, eventData) => {\n              if (mapInteractive) {\n                setLonLat([map.getCenter().lng, map.getCenter().lat]);\n              }\n            }}\n            onZoomEnd={(map, eventData) => {\n              if (mapInteractive) {\n                setZoom(map.getZoom());\n              }\n            }}\n            onStyleLoad={(map) => {\n              var layers = map.getStyle().layers;\n              // Find the index of the first symbol layer in the map style\n              var firstSymbolId;\n              for (let i = 0; i < layers.length; i++) {\n                if (layers[i].type === \"symbol\") {\n                  firstSymbolId = layers[i].id;\n                  break;\n                }\n              }\n              let hardwareImg = new Image(20, 20);\n              hardwareImg.onload = () => map.addImage(\"hardware-pattern\", hardwareImg);\n              hardwareImg.src = hardwarePattern;\n              //add layer for each good with map\n              props.digitalGoods.map((good) => {\n                // check if layer is already created\n                if (map.getLayer(good.name + \"-develop\")) {\n                  console.log(good.name + \" is layer already created\");\n                  return;\n                } else {\n                  map.addLayer(\n                    {\n                      id: good.name + \"-develop\",\n                      source: {\n                        type: \"vector\",\n                        url: \"mapbox://rolikasi.2kn4jvyh\",\n                      },\n                      \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n                      type: \"fill\",\n                      paint: {\n                        // 'fill-color': '#db3d44', // this is the color you want your tileset to have (red)\n                        \"fill-pattern\": \"hardware-pattern\", //this helps us distinguish individual countries a bit better by giving them an outline\n                      },\n                    },\n                    firstSymbolId\n                  );\n                  map.setLayoutProperty(good.name + \"-develop\", \"visibility\", \"none\");\n\n                  map.setFilter(\n                    good.name + \"-develop\",\n                    [\"in\", \"ADM0_A3_IS\"].concat(\n                      Object.keys(good.locations.developmentCountries)\n                    )\n                  ); // This line lets us filter by country codes.\n\n                  map.addLayer(\n                    {\n                      id: good.name + \"-deploy\",\n                      source: {\n                        type: \"vector\",\n                        url: \"mapbox://rolikasi.2kn4jvyh\",\n                      },\n                      \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n                      type: \"fill\",\n                      paint: {\n                        // 'fill-color': '#db3d44', // this is the color you want your tileset to have (red)\n                        \"fill-color\": \"#3333AB\", //this helps us distinguish individual countries a bit better by giving them an outline\n                        \"fill-opacity\": 0.2,\n                      },\n                    },\n                    firstSymbolId\n                  );\n                  map.setLayoutProperty(good.name + \"-deploy\", \"visibility\", \"none\");\n\n                  map.setFilter(\n                    good.name + \"-deploy\",\n                    [\"in\", \"ADM0_A3_IS\"].concat(\n                      Object.keys(good.locations.deploymentCountries)\n                    )\n                  ); // This line lets us filter by country codes.\n                }\n              });\n\n              // Declare the image\n              if (map.getLayer(\"Pathfinders Exploratory\")) {\n                console.log(\"Pathfinders Exploratory is layer already created\");\n                return;\n              } else {\n                let exploratoryImg = new Image(20, 20);\n                exploratoryImg.onload = () =>\n                  map.addImage(\"exploratory-pattern\", exploratoryImg);\n                exploratoryImg.src = exploratoryPattern;\n\n                // Use it\n                map.addLayer(\n                  {\n                    // adding a layer containing the tileset with country boundaries\n                    id: \"Pathfinders Exploratory\", //this is the name of our layer, which we will need later\n                    source: {\n                      type: \"vector\",\n                      url: \"mapbox://rolikasi.2kn4jvyh\",\n                    },\n                    \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n                    type: \"fill\",\n                    paint: {\n                      \"fill-pattern\": \"exploratory-pattern\",\n                      \"fill-opacity\": 0.5,\n                    },\n                    layout: {\n                      visibility: \"none\",\n                    },\n                  },\n                  firstSymbolId\n                );\n\n                map.setFilter(\n                  \"Pathfinders Exploratory\",\n                  [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(props.pathfinderExploratory))\n                ); // This line lets us filter by country codes.\n              }\n\n              if (map.getLayer(\"Pathfinders Confirmed\")) {\n                console.log(\"Pathfinders Confirmed layer is already created\");\n                return;\n              } else {\n                // Declare the image\n                let confirmedImg = new Image(20, 20);\n                confirmedImg.onload = () =>\n                  map.addImage(\"confirmed-pattern\", confirmedImg);\n                confirmedImg.src = confirmedPattern;\n\n                // Use it\n                map.addLayer(\n                  {\n                    // adding a layer containing the tileset with country boundaries\n                    id: \"Pathfinders Confirmed\", //this is the name of our layer, which we will need later\n                    source: {\n                      type: \"vector\",\n                      url: \"mapbox://rolikasi.2kn4jvyh\",\n                    },\n                    \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n                    type: \"fill\",\n                    paint: {\n                      \"fill-pattern\": \"confirmed-pattern\",\n                      \"fill-opacity\": 0.5,\n                    },\n                    layout: {\n                      visibility: \"none\",\n                    },\n                  },\n                  firstSymbolId\n                );\n\n                map.setFilter(\n                  \"Pathfinders Confirmed\",\n                  [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(props.pathfinderConfirmed))\n                ); // This line lets us filter by country codes.\n              }\n\n              if (map.getLayer(\"countries\")) {\n                console.log(\"countries layer is already created\");\n                return;\n              } else {\n                map.addLayer(\n                  {\n                    // adding a layer containing the tileset with country boundaries\n                    id: \"countries\", //this is the name of our layer, which we will need later\n                    source: {\n                      type: \"vector\",\n                      url: \"mapbox://rolikasi.2kn4jvyh\",\n                    },\n                    \"source-layer\": \"ne_10m_admin_0_countries-dxlasx\",\n                    type: \"fill\",\n                    paint: {\n                      \"fill-color\": \"white\", //this helps us distinguish individual countries a bit better by giving them an outline\n                      \"fill-opacity\": 0,\n                    },\n                  },\n                  firstSymbolId\n                );\n\n                map.setFilter(\n                  \"countries\",\n                  [\"in\", \"ADM0_A3_IS\"].concat(Object.keys(props.countries))\n                ); // This line lets us filter by country codes.\n                console.log('map.getLayer(\"countries\")', map.getLayer(\"countries\"));\n\n                // Add 3d layer with extrudes\n                map.addSource(\"DPGs developed-polygons-source\", {\n                  type: \"geojson\",\n                  data: props.devPolygons,\n                });\n                map.addSource(\"DPGs deployed-polygons-source\", {\n                  type: \"geojson\",\n                  data: props.depPolygons,\n                });\n\n                map.addLayer({\n                  id: \"DPGs developed\",\n                  source: \"DPGs developed-polygons-source\",\n                  type: \"fill-extrusion\",\n                  paint: {\n                    \"fill-extrusion-color\": \"#FF952A\",\n                    \"fill-extrusion-height\": [\"get\", \"height\"],\n                    \"fill-extrusion-base\": [\"get\", \"base\"],\n                  },\n                  layout: {\n                    visibility: \"none\",\n                  },\n                });\n\n                map.addLayer({\n                  id: \"DPGs deployed\",\n                  source: \"DPGs deployed-polygons-source\",\n                  type: \"fill-extrusion\",\n                  paint: {\n                    \"fill-extrusion-color\": \"#3333AB\",\n                    \"fill-extrusion-height\": [\"get\", \"height\"],\n                    \"fill-extrusion-base\": [\"get\", \"base\"],\n                  },\n                  layout: {\n                    visibility: \"none\",\n                  },\n                });\n                [\"DPGs deployed\", \"DPGs developed\"].map((layer, i) =>\n                  map.addLayer({\n                    id: `${layer}-text`,\n                    source: `${layer}-polygons-source`,\n                    type: \"symbol\",\n                    paint: {\n                      \"text-color\": [\"#3333AB\", \"#FF952A\"][i],\n                      \"text-halo-color\": \"#fff\",\n                      \"text-halo-width\": 1,\n                    },\n                    layout: {\n                      \"text-field\": [\"get\", \"text-field\"],\n                      \"text-size\": [\"interpolate\", [\"linear\"], [\"zoom\"], 4.5, 0, 5, 16],\n                      \"text-offset\": [\n                        \"interpolate\",\n                        [\"linear\"],\n                        [\"zoom\"],\n                        4.5,\n                        [\"literal\", [0, 0.5]],\n                        9,\n                        [\"literal\", [0, 3]],\n                      ],\n                      visibility: \"none\",\n                    },\n                  })\n                );\n                setLoading(false);\n                // set map so we can resize() it in future from anywhere\n                setMapInstance(map);\n\n                // set country info when clicked on country with any data\n                map.on(\"click\", \"countries\", function (mapElement) {\n                  handleSelectCountry(mapElement.features[0].properties.ADM0_A3_IS);\n                });\n                map.on(\"mouseenter\", \"countries\", () => {\n                  map.getCanvas().style.cursor = \"pointer\";\n                });\n                map.on(\"mouseleave\", \"countries\", () => {\n                  map.getCanvas().style.cursor = \"\";\n                });\n              }\n            }}\n          >\n            <ZoomControl position=\"bottom-right\" />\n            <MapContext.Consumer>\n              {(map) => {\n                Object.keys(visibleLayer).map((layer) => {\n                  console.log(\"toggle \", layer, \" visibility\");\n                  map.getLayer(layer)\n                    ? map.setLayoutProperty(\n                        layer,\n                        \"visibility\",\n                        visibleLayer[layer] ? \"visible\" : \"none\"\n                      )\n                    : null;\n\n                  // toggle text layer for 3d visualizations\n                  if ([\"DPGs developed\", \"DPGs deployed\"].includes(layer)) {\n                    map.getLayer(layer + \"-text\")\n                      ? map.setLayoutProperty(\n                          layer + \"-text\",\n                          \"visibility\",\n                          visibleLayer[layer] ? \"visible\" : \"none\"\n                        )\n                      : null;\n                  }\n                });\n\n                if (prevGood.name) {\n                  console.log(\"toggle prevgood visibility\");\n                  map.setLayoutProperty(prevGood.name + \"-develop\", \"visibility\", \"none\");\n                  map.setLayoutProperty(prevGood.name + \"-deploy\", \"visibility\", \"none\");\n                }\n                if (selectedGood.name) {\n                  console.log(\"toggle selected good visibility\");\n                  map.setLayoutProperty(\n                    selectedGood.name + \"-develop\",\n                    \"visibility\",\n                    \"visible\"\n                  );\n                  map.setLayoutProperty(\n                    selectedGood.name + \"-deploy\",\n                    \"visibility\",\n                    \"visible\"\n                  );\n                }\n              }}\n            </MapContext.Consumer>\n          </Map>\n        </div>\n        <InView\n          as=\"div\"\n          onChange={(inView) => {\n            setMapInteractive(!inView);\n            if (mapInstance) mapInstance.resize();\n          }}\n        >\n          <div className=\"scroller\">\n            <Scrollama onStepEnter={onStepEnter} offset=\"0.7\">\n              {props.story.map((_, stepIndex) => (\n                <Step data={stepIndex} key={stepIndex}>\n                  <div\n                    className={`scrolly-p ${stepIndex == 0 ? \"first\" : \"\"} ${\n                      stepIndex == props.story.length - 1 ? \"last\" : \"\"\n                    }`}\n                  >\n                    <p>{_.text}</p>\n                    {stepIndex == 0 && (\n                      <div>\n                        <p>\n                          Scroll down to see the story or skip it and{\" \"}\n                          <span className=\"button\" onClick={handleScrollToBottom}>\n                            explore the map\n                          </span>\n                        </p>\n\n                        <div className=\"scrollArrows\">\n                          <span></span>\n                          <span></span>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </Step>\n              ))}\n            </Scrollama>\n          </div>\n        </InView>\n\n        <div\n          className={\n            selectedGood.name || (Object.values(visibleLayer).some(item => item) && !mapInteractive) && props.story[currentStepIndex].image == \"false\"\n              ? \"map-overlay active\"\n              : \"map-overlay\"\n          }\n          id=\"legend\"\n        >\n          <div className=\"legendContainer\">\n            {selectedGood.name && legends.map((legend, index) => (\n              <div key={legend + index}>\n                <span\n                  className=\"legend-key\"\n                  style={\n                    index == 0\n                      ? {backgroundImage: `url(${hardwarePattern})`}\n                      : {backgroundColor: colors[index]}\n                  }\n                ></span>\n                <span>{legend}</span>\n              </div>\n            ))}\n            {!mapInteractive && Object.entries(visibleLayer).map((layer, index) => {\n              return layer[1] &&\n              <div key={layer[0] + index}>\n                <span\n                  className=\"legend-key rectangle\"\n                  style={layerStyles[layer[0]]\n                  }\n                ></span>\n                <span>{layer[0]}</span>\n              </div>\n            })}\n          </div>\n        </div>\n      </div>\n      {mapInteractive && width >= 1008 && (\n        <InfoComponent\n          selectedGood={selectedGood}\n          selectedCountry={selectedCountry}\n          onSelectGood={handleSelectGoodPopup}\n          onSelectCountry={handleSelectCountry}\n          onLayerToggle={handleLayerToggle}\n          visibleLayer={visibleLayer}\n          ref={ref}\n          SearchBox={\n            <SearchBox\n              ref={searchRef}\n              goods={props.digitalGoods}\n              countries={props.countries}\n              onSelectCountry={handleSelectCountry}\n              selectedGood={selectedGood.name}\n              selectedCountry={selectedCountry.name}\n              onSelectGood={handleChangeSearchbox}\n              clearSelectedGood={handleClearSearchbox}\n            />\n          }\n        />\n      )}\n      {width < 1008 && (\n        <InfoComponent\n          selectedGood={selectedGood}\n          selectedCountry={selectedCountry}\n          onSelectGood={handleSelectGoodPopup}\n          onSelectCountry={handleSelectCountry}\n          visibleLayer={visibleLayer}\n          onLayerToggle={handleLayerToggle}\n          ref={ref}\n        />\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}